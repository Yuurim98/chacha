<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<!--mapper에서 사용하는 커스텀태그가 정의되어 있는 곳 임포트 시킴-->
 
 <!--mypage.xml-->
 <mapper namespace="mypage">
 	
 	
 <select id="myeduList" resultType="kr.co.chacha.mypage.MypageDTO">
 	SELECT myno, uid, eduno, mycon, mydate, mystate, mycomple
	FROM myeducation
	WHERE uid = #{uid}
	ORDER BY myno		
 </select>
 
 
  <select id="myHelp" resultType="kr.co.chacha.mypage.MypageDTO">
	SELECT textno, texttitle, uploaddate, cnt_help, uid
	FROM help
	WHERE uid = #{uid}		
 </select>
 
  <select id="myAdoprv" resultType="kr.co.chacha.mypage.MypageDTO">
	SELECT arno, artitle, ardate, cnt_adoprv, uid
	FROM adoprv
	WHERE uid = #{uid}
 </select>
 	
  <select id="mysvList" resultType="kr.co.chacha.mypage.MypageDTO">
	SELECT sa.sano, sa.sadate, sa.stime, sa.astate , sc.stitle, sa.sno
	FROM servicea sa JOIN service sc
	ON sa.sno = sc.sno
	WHERE sa.uid = #{uid}	
 </select>
 
 
 <select id="jjimList" resultType="kr.co.chacha.mypage.MypageDTO">
	SELECT ani.jjim_icon, ani.anipic, ani.aname, ani.gender, ani.age, ani.weight, ani.genop, ani.vac, jj.anino
	FROM jjim jj join animal ani
	ON jj.anino = ani.anino
	WHERE jj.uid = #{uid} and ani.jjim_icon = 1
 </select>
 
 
 <select id="myComment" resultType="kr.co.chacha.mypage.MypageDTO">
	SELECT ac.comno, ac.adcm, ar.artitle, ac.acdate
	FROM adopcm ac join adoprv ar
	ON ac.arno = ar.arno
	WHERE ac.uid = #{uid}
 </select>
 
 
  <select id="myAdopt" resultType="kr.co.chacha.mypage.MypageDTO">
  SELECT AA.apno, AA.anipic, AA.sub_cont, AA.sub_state, AA.subpic, py.payno, py.payop, py.pdate, py.paymet, py.patamt, AA.sub_date
	FROM payment py
	JOIN (
		    SELECT ap.apno, an.anipic, ap.sub_cont, ap.sub_state, ap.subpic, ap.sub_date
		    FROM adopt ap
		    JOIN animal an ON ap.uid = an.uid
		    WHERE ap.uid = #{uid}
	     ) AA ON py.apno = AA.apno
	WHERE py.uid = #{uid}
 </select>
 
 
  <select id="checkPasswd" parameterType="String" resultType="Int">
 	SELECT COUNT(*)
	FROM member
	WHERE passwd = #{passwd}
 </select>

 
 <update id="memberWithdraw" parameterType="String">
	UPDATE member
	SET mlevel = 'D'
	WHERE uid = #{uid}
 </update>
 
 
 <select id="myInfoCheck" resultType="kr.co.chacha.mypage.MypageDTO" parameterType="String">
	SELECT uname, uid, email, passwd, tel, birth, zipcode, addr1, addr2
	FROM member 
	WHERE uid = #{uid}
 </select>


 <update id="memberModify" parameterType="kr.co.chacha.mypage.MypageDTO">
	UPDATE member
	SET passwd = #{passwd}, tel = #{tel}, birth = #{birth}, zipcode = #{zipcode}, addr1 = #{addr1}, addr2 = #{addr2} 
	WHERE uid = #{uid}
 </update>

 	
 </mapper>
 
 
 

 

 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 